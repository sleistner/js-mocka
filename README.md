Shamless port of http://github.com/imedo/jsmock/

Thanks @tkadauke for the awesome code.